<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Dillo: Handling Elements Out Of Flow: Floats</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="https://www.dillo.org/dw/html/jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Dillo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Handling Elements Out Of Flow: Floats </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>TODO: Much missing.</p>
<p>(Historical) Note: Floats make use of dw-size-request-pos, which reduces the complexity of a previous design.</p>
<h1>Sorting floats </h1>
<p>Floats are sorted, to make binary search possible, in these lists:</p>
<ul>
<li>for each generator: dw::OutOfFlowMgr::TBInfo::leftFloatsGB and dw::OutOfFlowMgr::TBInfo::rightFloatsGB;</li>
<li>for the container: dw::OutOfFlowMgr::leftFloatsCB and dw::OutOfFlowMgr::rightFloatsCB.</li>
</ul>
<p>The other two lists, dw::OutOfFlowMgr::leftFloatsAll and dw::OutOfFlowMgr::rightFloatsAll are not sorted at all.</p>
<p>New floats are always added to the end of either list; this order is called <em>generation order</em>. See also above: <em>GB lists and CB lists</em>.</p>
<p>On the other hand, there are different sorting criteria, implemented by different comparators, so that different kinds of keys may be used for searching. These sorting criteria are equivalent to the generation order.</p>
<p>dw::OutOfFlowMgr::Float::CompareSideSpanningIndex compares sideSpanningIndex* (used to compare floats to those on the respective other side); if you look at the definition (dw::OutOfFlowMgr::addWidgetOOF) it becomes clear that this order is equivalent to the generation order.</p>
<p>dw::OutOfFlowMgr::Float::CompareGBAndExtIndex compares <em>externalIndex</em> for floats with same generators, otherwise: (i) if one generator (T1) is a direct ancestor of the other generator (T2), the child of T1, which is an ancestor of, or identical to, T2 is compared to the float generated by T1, using <em>externalIndex</em>, as in this example: </p><pre class="fragment">T1 -+-&gt; child --&gt; ... -&gt; T2 -&gt; Float
    `-&gt; Float
</pre><p>Otherwise, the two blocks are compared, according to their position in dw::OutOfFlowMgr::tbInfos: </p><pre class="fragment">common ancestor -+-&gt; ... --&gt; T1 -&gt; Float
                  `-&gt; ... --&gt; T2 -&gt; Float
</pre><p>This is equivalent to the generation order, as long it is ensured that externalIndex* reflects the generation order within a generating block, for both floats and child blocks.</p>
<p>dw::OutOfFlowMgr::Float::ComparePosition ...</p>
<h1>Miscellaneous notes </h1>
<h2>Handling collisions </h2>
<p>The CSS specification allows two strategies to deal with colliding floats: placing the second float beside or below the first one. Many other browsers implement the first approach, while dillo implements the second one, which may cause problems when the author assumes the first. Example: the "tabs" at the top of every page at Wikipedia ("Article", "Talk", ...).</p>
<h2>Float containers in flow </h2>
<p>Consider the following HTML snippet: </p><pre class="fragment">&lt;body&gt;
  &lt;img src="....jpg" style="float:right"&gt;
  &lt;p style="overflow:hidden"&gt;Text&lt;/p&gt;
&lt;/body&gt;
</pre><p>Interestingly, dillo shows "Text" always <em>below</em> the image, even if there is enough space left of it. An investigation shows that the paragraph (&lt;p&gt;) is regarded as own floats container (because of overflow:hidden*), so the floats container above (&lt;body&gt;) regards this block as widget which must be fit between the floats (<a class="el" href="classdw_1_1Textblock.html#a7f450954794ee0f0b8460ed2fc6df91c">dw::Textblock::mustBorderBeRegarded</a> &gt; <a class="el" href="classdw_1_1Textblock.html#a5aef1b0612b78461d6af4dcc3a6760bc">dw::Textblock::getWidgetRegardingBorderForLine</a>). However, since a textblock in flow always covers (at least) the whole available width, which is defined <em>without</em> considering floats, the space left of the float will always be to narrow, so that the paragraph is moved below the float, by inserting an empty line before.</p>
<p>When searching for a solution, several difficulties show up:</p>
<ol type="1">
<li>The available width, which is used for the width of the textblock, is defined independent of floats. Aside from problems when changing this definition, a dependance on floats would be difficult to implement, since <em>sizeRequest</em> is independent of a position. (See also <a class="el" href="dw-out-of-flow.html">Handling Elements Out Of Flow</a>.)</li>
<li>I must admit that I do not rembember the exact rationale and the test case behind adding the exception in <a class="el" href="classdw_1_1Textblock.html#a5aef1b0612b78461d6af4dcc3a6760bc">dw::Textblock::getWidgetRegardingBorderForLine</a> (see above), but simply removing this exception will result in a possible overlapping of floats from both containers, since no collisions are tested for.</li>
<li>On the other hand, mixing the float containers (interaction of two or more instances of <a class="el" href="classdw_1_1oof_1_1OOFFloatsMgr.html" title="OutOfFlowMgr implementation dealing with floats. ">dw::oof::OOFFloatsMgr</a>), e.&#160;g. for collision tests, would become too complex and possibly result in performance problems.</li>
</ol>
<p>Instead, this approach is focussed:</p>
<ul>
<li>Goal: the paragraph is narrowed so it fits, <em>as a whole</em>, between the floats.</li>
<li>The approach is to remove the exception in <a class="el" href="classdw_1_1Textblock.html#a5aef1b0612b78461d6af4dcc3a6760bc">dw::Textblock::getWidgetRegardingBorderForLine</a>. A textblock, which is a float container in flow (as this paragraph), is returned by this method and so <a class="el" href="classdw_1_1Textblock.html#a7f450954794ee0f0b8460ed2fc6df91c">dw::Textblock::mustBorderBeRegarded</a> returns true*. This will put this paragraph again at the correct position.</li>
<li>To avoid overlappings, the linebreaking width of this paragraph (which is also used for positioning of floats) is the available width, minus the maximal float width on either side. (This is an approach similar to the one <a class="el" href="classdw_1_1Ruler.html" title="Widget for drawing (horizontal) rules. ">dw::Ruler</a> will use soon). Most likely, some new methods will have to be added to calculate this.</li>
<li>For paragraphs like this, dw::Textblock::borderChanged must rewrap all lines; <em>y</em> is irrelevant in this case.</li>
<li>Since the textblock will tend to become taller when getting narrower, and so possibly cover more (wider) floats, and so become narrower again etc., there may be multible solutions for calculating the size. Generally, a smaller height (and so larger width) is preferred.</li>
<li>There remains a problem: what if a word is too large? Should a textblock of this kind then reard the floats in detail, to insert empty lines when needed?</li>
</ul>
<p><b>Real-world cases:</b> <em>Overflow:hidden</em> is set for headings in Wikipedia, and so this case occurs when there is a float (thumb image) before a heading. See e.&#160;g. <a href="http://de.wikipedia.org/wiki/Emmerich_am_Rhein#Ans.C3.A4ssige_Unternehmen">this page</a> and scroll a bit up; the company logos should be right of this section.</p>
<p><b>Priority:</b> Since this is not a regression, compared to not supporting floats at all, a fix is not urgent for a new release.</p>
<h2>Resizing </h2>
<p>Has the case that a float changes its position to be regarded? Probably yes, but cases where no other mechanisms come into play are rather unlikely.</p>
<p><b>Priority:</b> If this plays a role, this means a regression compared to not supporting floats at all. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 28 2016 11:47:43 for Dillo by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
